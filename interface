import mysql.connector as connector
# import datetime
con = connector.connect(host='localhost', user='root', passwd = 'SQL@hehe23', database = 'flipmartdb')
if con.is_connected():
    print("Success")
else:
    print("Failure")

mycursor = con.cursor()

# mycursor.execute("select * from Cart where product_ID = 10")

# for x in mycursor:
#     print(x)
def adminOrCustomer():
    print("Enter 1 for Admin and 2 for Customer:")
    n = int(input())
    return n
def adminMenu():
    print("Enter 1 to view all the available products.")
    print("Enter 0 to exit.")
    ch = int(input("Enter choice: "))
    return ch
def viewAvailableProducts(pincode):
    mycursor.execute(f"Select * from Available where Pincode = {pincode}")
    listprods = mycursor.fetchall()
    print("Product_ID\tQuantity")
    for i in listprods:
        print(f"{i[1]}\t{i[2]}")
    return 0
def insideAdmin():
    print("Entering as Admin: ")
    username = input("Enter Username: ")
    # mycursor.execute(f"Select * from Admin where Username = {username}")
    # listadmins = mycursor.fetchall()
    # if len(listadmins)==0:
    #     #no such username found
    #     print("No such user found")
    #     ch = int(input("Enter 1 to continue or 0 to exit: "))
    #     return ch
    passw = input("Enter password: ")
    mycursor.execute(f"Select * from Admin where Username = {username} and Pass_word = {passw}")
    listadmins = mycursor.fetchall()
    admin = listadmins[0]
    if len(listadmins)==0:
        #no such username found
        print("No such user found")
        ch = int(input("Enter 0 to continue or -1 to exit: "))
        return ch
    elif len(listadmins)>1:
        userid = int(input("Enter User ID: "))
        mycursor.execute(f"Select * from Admin where user_id = {userid}")
        admin = mycursor.fetchone()
    branch_pincode = admin[3]
    mycursor.execute(f"Select Area from Branch where Pincode = {branch_pincode}")
    branch_name = mycursor.fetchone()
    print(f"You have access to the records of Area: {branch_name}")
    admin_ch = adminMenu()
    if admin_ch == 0:
        ret = int(input("Enter 0 to login again or -1 to exit the program: "))
        return ret
    if admin_ch == 1:
        admin_ch = viewAvailableProducts(branch_pincode)
    # return admin_ch
def customerMenu():
    print("Enter 1 to view all the available products.")
    print("Enter 0 to exit.")
    ch = int(input("Enter choice: "))
    return ch
def insideCustomer():
    print("Entering as Admin: ")
    name = input("Enter your name: ")
    mycursor.execute(f"Select * from Customer where Name = {name}")
    listcus = mycursor.fetchall()
    customer = listcus[0]
    if len(listcus) == 0:
        print("No such customer found")
        ch = int(input("Enter 0 to continue or -1 to exit: "))
        return ch
    elif len(listcus)>1:
        userid = int(input("Enter User ID: "))
        mycursor.execute(f"Select * from Customer where User_ID = {userid}")
        customer = mycursor.fetchone()
    branch_pincode = customer[4]
    mycursor.execute(f"Select Area from Branch where Pincode = {branch_pincode}")
    branch_name = mycursor.fetchone()
    cus_ch = customerMenu()
    if cus_ch == 0:
        ret = int(input("Enter 0 to login again or -1 to exit the program: "))
        return ret
    elif cus_ch == 1:
        cus_ch = viewAvailableProducts(branch_pincode)
    #return cus_ch
print("Welcome User!")
print("Are you an admin or customer?")
while True:
    aorc = adminOrCustomer()
    if aorc == 0:
        print("Goodbye user!")
        break
    elif aorc == 1:
        ch = insideAdmin()
        if ch == -1:
            break
        elif ch == 0:
            continue
    elif aorc == 2:
        ch = insideCustomer()
        if ch == -1:
            break
        elif ch == 0:
            continue
